# IoT-MQTT ç³»çµ±åŸ·è¡Œèªªæ˜
# èª²ç¨‹ï¼šç‰©è¯ç¶²é€šè¨Šå¯¦å‹™
# æ•™å¸«ï¼šè¬ç‡¿è°è€å¸«
# å­¸ç”Ÿï¼šé‚±ä½©åŸ

## ğŸ“‹ ç³»çµ±æ¦‚è¿°
æœ¬å°ˆæ¡ˆå±•ç¤ºä¸€å€‹å®Œæ•´çš„ Docker åŒ– MQTT è¨‚é–±è€…ç³»çµ±ï¼ŒåŒ…å«ï¼š
1. MQTT è¨‚é–±è€…ç¨‹å¼ (subscriber.py, tmp-sub.py)
2. MQTT ç™¼å¸ƒè€…ç¨‹å¼ (publisher.py)
3. Docker å®¹å™¨åŒ–é…ç½® (Dockerfile, appRun.sh)

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Python ç›´æ¥åŸ·è¡Œ
```bash
# 1. å®‰è£ Python å¥—ä»¶
pip install -r requirements.txt

# 2. å•Ÿå‹• MQTT Broker (éœ€è¦å…ˆå®‰è£ mosquitto)
# æˆ–ä½¿ç”¨ Docker: docker run -d -p 1883:1883 eclipse-mosquitto

# 3. å•Ÿå‹•è¨‚é–±è€… (çµ‚ç«¯æ©Ÿ 1)
python subscriber.py

# 4. ç™¼å¸ƒæ¸¬è©¦è¨Šæ¯ (çµ‚ç«¯æ©Ÿ 2)
python publisher.py
# æˆ–ä½¿ç”¨çµ‚ç«¯æ©Ÿå‘½ä»¤:
# mosquitto_pub -h 127.0.0.1 -p 1883 -t aiot-113/n26/h-t -m "69.1 31.1"
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ Docker å®¹å™¨åŒ–åŸ·è¡Œ
```bash
# 1. å»ºç½® Docker æ˜ åƒæª”
docker build -t iot_mqtt:112 .

# 2. åŸ·è¡Œå®¹å™¨
docker run -d \
    --name iot_mqtt \
    --restart unless-stopped \
    -v $(pwd):/x \
    -v ~/log_mqtt:/xlog_mqtt \
    iot_mqtt:112

# 3. æŸ¥çœ‹å®¹å™¨ç‹€æ…‹
docker ps
docker logs iot_mqtt
```

### æ–¹æ³•ä¸‰ï¼šçµ‚ç«¯æ©Ÿç›´æ¥æ¸¬è©¦
```bash
# è¨‚é–±ä¸»é¡Œ (çµ‚ç«¯æ©Ÿ 1)
mosquitto_sub -h 127.0.0.1 -p 1883 -t aiot-113/n26/h-t

# ç™¼å¸ƒè¨Šæ¯ (çµ‚ç«¯æ©Ÿ 2)
mosquitto_pub -h 127.0.0.1 -p 1883 -t aiot-113/n26/h-t -m "69.1 31.1"
```

## ğŸ“Š æ¸¬è©¦çµæœé©—è­‰
1. è¨‚é–±è€…çµ‚ç«¯æ©Ÿæœƒé¡¯ç¤ºæ”¶åˆ°çš„è¨Šæ¯
2. é€²éšç‰ˆæœ¬ (tmp-sub.py) æœƒå°‡æ•¸æ“šç™¼é€åˆ° HTTP ä¼ºæœå™¨
3. Docker å®¹å™¨æœƒè¨˜éŒ„æ—¥èªŒåˆ° ~/log_mqtt ç›®éŒ„

## ğŸ”§ å¸¸è¦‹å•é¡Œ
### Q1: Connection refused éŒ¯èª¤
A: ç¢ºä¿ MQTT Broker æ­£åœ¨åŸ·è¡Œ

### Q2: ModuleNotFoundError: No module named 'paho'
A: åŸ·è¡Œ `pip install -r requirements.txt`

### Q3: Docker build å¤±æ•—
A: ç¢ºä¿æœ‰ iot_data:112 åŸºç¤æ˜ åƒæª”ï¼Œæˆ–ä¿®æ”¹ Dockerfile
